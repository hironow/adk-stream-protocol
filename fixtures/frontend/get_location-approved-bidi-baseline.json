{
  "description": "BIDI Blocking Mode - get_location with approval flow (SINGLE CONTINUOUS STREAM)",
  "mode": "bidi",
  "source": "Backend E2E test capture",
  "scenario": "User approves get_location tool call - BIDI Blocking Mode where tool awaits approval inside function",
  "note": "BIDI Blocking Mode behavior: Single continuous stream with 1 [DONE]. Tool enters BLOCKING state awaiting approval, then returns location result after approval.",
  "input": {
    "messages": [
      {
        "id": "msg-1",
        "role": "user",
        "content": "現在地を教えて"
      }
    ],
    "trigger": "submit-message"
  },
  "output": {
    "rawEvents": [
      "data: {\"type\": \"start\", \"messageId\": \"32fd9b04-8f23-43f8-8855-46af69018d38\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"0\", \"delta\": \"**Recognizing the Request**\\n\\nOkay, I've identified the user's request for their current location, which is expressed in Japanese. I've successfully connected this request to my `get_location` tool. Now I'm preparing to call the tool, as it seems to be the most appropriate solution to fulfill this need. It\\u2019s also important to remember that it requires user approval, something I will need to handle.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-2739595405215658348\", \"toolName\": \"get_location\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-2739595405215658348\", \"toolName\": \"get_location\", \"input\": {}}\n\n",
      "data: {\"type\":\"start-step\"}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-2739595405215658348\", \"approvalId\": \"confirm-23df2fb0-8b35-4d15-87b3-bfcc4dd212a6\"}\n\n",
      "data: {\"type\":\"finish-step\"}\n\n",
      "data: {\"type\": \"tool-output-available\", \"toolCallId\": \"function-call-2739595405215658348\", \"output\": {\"latitude\": 35.6762, \"longitude\": 139.6503, \"accuracy\": 20, \"city\": \"Tokyo\", \"country\": \"Japan\"}}\n\n",
      "data: {\"type\": \"text-start\", \"id\": \"32fd9b04-8f23-43f8-8855-46af69018d38_output_text\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"32fd9b04-8f23-43f8-8855-46af69018d38_output_text\", \"delta\": \"\\u73fe\\u5728\\u5730\\u306f\\u3001\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"32fd9b04-8f23-43f8-8855-46af69018d38_output_text\", \"delta\": \"\\u6771\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"32fd9b04-8f23-43f8-8855-46af69018d38_output_text\", \"delta\": \"\\u4eac\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"32fd9b04-8f23-43f8-8855-46af69018d38_output_text\", \"delta\": \"\\u90fd\\u3067\\u3059\\u3002\"}\n\n",
      "data: {\"type\": \"text-end\", \"id\": \"32fd9b04-8f23-43f8-8855-46af69018d38_output_text\"}\n\n",
      "data: {\"type\": \"finish\", \"finishReason\": \"stop\", \"messageMetadata\": {\"usage\": {\"promptTokens\": 1519, \"completionTokens\": null, \"totalTokens\": 1569}, \"audio\": {\"chunks\": 26, \"bytes\": 94080, \"sampleRate\": 24000, \"duration\": 1.96}, \"modelVersion\": \"gemini-2.5-flash-native-audio-preview-12-2025\"}}\n\n",
      "data: [DONE]\n\n"
    ],
    "expectedChunks": [
      {
        "type": "start",
        "messageId": "32fd9b04-8f23-43f8-8855-46af69018d38"
      },
      {
        "type": "reasoning-start",
        "id": "0"
      },
      {
        "type": "reasoning-delta",
        "id": "0",
        "delta": "**Recognizing the Request**\n\nOkay, I've identified the user's request for their current location, which is expressed in Japanese. I've successfully connected this request to my `get_location` tool. Now I'm preparing to call the tool, as it seems to be the most appropriate solution to fulfill this need. It’s also important to remember that it requires user approval, something I will need to handle.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "0"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-2739595405215658348",
        "toolName": "get_location"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-2739595405215658348",
        "toolName": "get_location",
        "input": {}
      },
      {
        "type": "start-step"
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-2739595405215658348",
        "approvalId": "confirm-23df2fb0-8b35-4d15-87b3-bfcc4dd212a6"
      },
      {
        "type": "finish-step"
      },
      {
        "type": "tool-output-available",
        "toolCallId": "function-call-2739595405215658348",
        "output": {
          "latitude": 35.6762,
          "longitude": 139.6503,
          "accuracy": 20,
          "city": "Tokyo",
          "country": "Japan"
        }
      },
      {
        "type": "text-start",
        "id": "32fd9b04-8f23-43f8-8855-46af69018d38_output_text"
      },
      {
        "type": "text-delta",
        "id": "32fd9b04-8f23-43f8-8855-46af69018d38_output_text",
        "delta": "現在地は、"
      },
      {
        "type": "text-delta",
        "id": "32fd9b04-8f23-43f8-8855-46af69018d38_output_text",
        "delta": "東"
      },
      {
        "type": "text-delta",
        "id": "32fd9b04-8f23-43f8-8855-46af69018d38_output_text",
        "delta": "京"
      },
      {
        "type": "text-delta",
        "id": "32fd9b04-8f23-43f8-8855-46af69018d38_output_text",
        "delta": "都です。"
      },
      {
        "type": "text-end",
        "id": "32fd9b04-8f23-43f8-8855-46af69018d38_output_text"
      },
      {
        "type": "finish",
        "finishReason": "stop",
        "messageMetadata": {
          "usage": {
            "promptTokens": 1519,
            "completionTokens": null,
            "totalTokens": 1569
          },
          "audio": {
            "chunks": 26,
            "bytes": 94080,
            "sampleRate": 24000,
            "duration": 1.96
          },
          "modelVersion": "gemini-2.5-flash-native-audio-preview-12-2025"
        }
      }
    ],
    "expectedDoneCount": 1,
    "expectedStreamCompletion": true
  }
}
