{
  "description": "BIDI mode Phase 12 BLOCKING - process_payment with approval flow (SINGLE CONTINUOUS STREAM)",
  "mode": "bidi",
  "source": "Backend E2E test capture",
  "scenario": "User approves process_payment tool call - Phase 12 BLOCKING mode where tool awaits approval inside function",
  "note": "Phase 12 BLOCKING behavior: Single continuous stream with 1 [DONE]. Tool enters BLOCKING state awaiting approval, then returns success result after approval. This is different from Phase 5 where tool returns pending immediately.",
  "input": {
    "messages": [
      {
        "id": "msg-1",
        "role": "user",
        "content": "次郎さんに200ドル送金してください"
      }
    ],
    "trigger": "submit-message"
  },
  "output": {
    "rawEvents": [
      "data: {\"type\": \"start\", \"messageId\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"0\", \"delta\": \"**Evaluating Payment Methods**\\n\\nI'm currently focused on identifying a suitable payment method for transferring $200 to \\\"\\u6b21\\u90ce\\u3055\\u3093\\\".  The `process_payment` tool seems promising, accepting an amount, recipient, and currency.  I'm slightly concerned about the recipient's identifier (\\\"\\u6b21\\u90ce\\u3055\\u3093\\\") since the tool typically uses emails, usernames, or wallet addresses, but I'll try it with the given input and see if it works. I plan to use USD as the currency.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"1\", \"delta\": \"**Confirming Payment Details**\\n\\nI've decided to proceed with the `process_payment` tool and input the exact provided recipient name, \\\"\\u6b21\\u90ce\\u3055\\u3093,\\\" along with the amount of $200 and currency, USD.  I'm hoping the tool can handle this identifier directly, or provide an informative error message if the format is invalid.  I'm ready to trigger the function now.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-11993019767497702616\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-11993019767497702616\", \"toolName\": \"process_payment\", \"input\": {\"recipient\": \"\\u6b21\\u90ce\\u3055\\u3093\", \"amount\": 200, \"currency\": \"USD\"}}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-11993019767497702616\", \"approvalId\": \"adk-2b341538-ab02-4472-afc4-8a2cfc372777\"}\n\n",
      "data: {\"type\": \"tool-output-available\", \"toolCallId\": \"function-call-11993019767497702616\", \"output\": {\"success\": true, \"transaction_id\": \"txn_ec59f24f5e8b\", \"amount\": 200, \"currency\": \"USD\", \"recipient\": \"\\u6b21\\u90ce\\u3055\\u3093\", \"description\": \"\", \"wallet_balance\": 800.0, \"timestamp\": \"2025-12-28T05:43:40.529607+00:00\"}}\n\n",
      "data: {\"type\": \"text-start\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\", \"delta\": \"\\u6b21\\u90ce\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\", \"delta\": \"\\u3055\\u3093\\u306b200\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\", \"delta\": \"\\u30c9\\u30eb\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\", \"delta\": \"\\u9001\\u91d1\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\", \"delta\": \"\\u304c\\u5b8c\\u4e86\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\", \"delta\": \"\\u3057\\u307e\\u3057\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\", \"delta\": \"\\u305f\\u3002\"}\n\n",
      "data: {\"type\": \"text-end\", \"id\": \"01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text\"}\n\n",
      "data: {\"type\": \"finish\", \"finishReason\": \"stop\", \"messageMetadata\": {\"usage\": {\"promptTokens\": 1687, \"completionTokens\": null, \"totalTokens\": 1757}, \"audio\": {\"chunks\": 42, \"bytes\": 124800, \"sampleRate\": 24000, \"duration\": 2.6}, \"modelVersion\": \"gemini-2.5-flash-native-audio-preview-12-2025\"}}\n\n",
      "data: [DONE]\n\n"
    ],
    "expectedChunks": [
      {
        "type": "start",
        "messageId": "01a91e2a-f28b-4649-8796-4b3b42f76a28"
      },
      {
        "type": "reasoning-start",
        "id": "0"
      },
      {
        "type": "reasoning-delta",
        "id": "0",
        "delta": "**Evaluating Payment Methods**\n\nI'm currently focused on identifying a suitable payment method for transferring $200 to \"次郎さん\".  The `process_payment` tool seems promising, accepting an amount, recipient, and currency.  I'm slightly concerned about the recipient's identifier (\"次郎さん\") since the tool typically uses emails, usernames, or wallet addresses, but I'll try it with the given input and see if it works. I plan to use USD as the currency.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "0"
      },
      {
        "type": "reasoning-start",
        "id": "1"
      },
      {
        "type": "reasoning-delta",
        "id": "1",
        "delta": "**Confirming Payment Details**\n\nI've decided to proceed with the `process_payment` tool and input the exact provided recipient name, \"次郎さん,\" along with the amount of $200 and currency, USD.  I'm hoping the tool can handle this identifier directly, or provide an informative error message if the format is invalid.  I'm ready to trigger the function now.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "1"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-11993019767497702616",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-11993019767497702616",
        "toolName": "process_payment",
        "input": {
          "recipient": "次郎さん",
          "amount": 200,
          "currency": "USD"
        }
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-11993019767497702616",
        "approvalId": "adk-2b341538-ab02-4472-afc4-8a2cfc372777"
      },
      {
        "type": "tool-output-available",
        "toolCallId": "function-call-11993019767497702616",
        "output": {
          "success": true,
          "transaction_id": "txn_ec59f24f5e8b",
          "amount": 200,
          "currency": "USD",
          "recipient": "次郎さん",
          "description": "",
          "wallet_balance": 800.0,
          "timestamp": "2025-12-28T05:43:40.529607+00:00"
        }
      },
      {
        "type": "text-start",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text"
      },
      {
        "type": "text-delta",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text",
        "delta": "次郎"
      },
      {
        "type": "text-delta",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text",
        "delta": "さんに200"
      },
      {
        "type": "text-delta",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text",
        "delta": "ドル"
      },
      {
        "type": "text-delta",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text",
        "delta": "送金"
      },
      {
        "type": "text-delta",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text",
        "delta": "が完了"
      },
      {
        "type": "text-delta",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text",
        "delta": "しまし"
      },
      {
        "type": "text-delta",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text",
        "delta": "た。"
      },
      {
        "type": "text-end",
        "id": "01a91e2a-f28b-4649-8796-4b3b42f76a28_output_text"
      },
      {
        "type": "finish",
        "finishReason": "stop",
        "messageMetadata": {
          "usage": {
            "promptTokens": 1687,
            "completionTokens": null,
            "totalTokens": 1757
          },
          "audio": {
            "chunks": 42,
            "bytes": 124800,
            "sampleRate": 24000,
            "duration": 2.6
          },
          "modelVersion": "gemini-2.5-flash-native-audio-preview-12-2025"
        }
      }
    ],
    "expectedDoneCount": 1,
    "expectedStreamCompletion": true
  }
}
