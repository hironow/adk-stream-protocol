{
  "description": "BIDI mode Phase 12 BLOCKING - process_payment with approval flow (SINGLE CONTINUOUS STREAM)",
  "mode": "bidi",
  "source": "Backend E2E test capture",
  "scenario": "User approves process_payment tool call - Phase 12 BLOCKING mode where tool awaits approval inside function",
  "note": "Phase 12 BLOCKING behavior: Single continuous stream with 1 [DONE]. Tool enters BLOCKING state awaiting approval, then returns success result after approval. This is different from Phase 5 where tool returns pending immediately.",
  "input": {
    "messages": [
      {
        "id": "msg-1",
        "role": "user",
        "content": "次郎さんに200ドル送金してください"
      }
    ],
    "trigger": "submit-message"
  },
  "output": {
    "rawEvents": [
      "data: {\"type\": \"start\", \"messageId\": \"26609b40-7707-4602-b262-67374e5d97d3\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"0\", \"delta\": \"**Defining the Tool Call**\\n\\nI'm now zeroing in on the correct `process_payment` tool call.  I've confirmed the recipient, Jiro-san, as a string and the amount, $200, in USD.  The tool parameters have been verified and I am ready to construct the call itself. It's almost ready for execution.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"1\", \"delta\": \"**Refining the Payment Parameters**\\n\\nI've firmed up the recipient, Jiro-san, as a string and the payment amount as $200 in USD. The `process_payment` tool is definitely the correct one to use. I'm now crafting the tool call with those exact values and ensuring the arguments align with the tool definition. The structure is almost complete for submission, just confirming the details.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-10272706747688841769\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-10272706747688841769\", \"toolName\": \"process_payment\", \"input\": {\"amount\": 200, \"recipient\": \"\\u6b21\\u90ce\\u3055\\u3093\", \"currency\": \"USD\"}}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-10272706747688841769\", \"approvalId\": \"adk-3430557d-fed3-4843-8e3c-e113d3e6dc5f\"}\n\n",
      "data: {\"type\": \"tool-output-available\", \"toolCallId\": \"function-call-10272706747688841769\", \"output\": {\"success\": true, \"transaction_id\": \"txn_97acab733d43\", \"amount\": 200, \"currency\": \"USD\", \"recipient\": \"\\u6b21\\u90ce\\u3055\\u3093\", \"description\": \"\", \"wallet_balance\": 800.0, \"timestamp\": \"2025-12-28T01:56:15.309941+00:00\"}}\n\n",
      "data: {\"type\": \"text-start\", \"id\": \"26609b40-7707-4602-b262-67374e5d97d3_output_text\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"26609b40-7707-4602-b262-67374e5d97d3_output_text\", \"delta\": \"\\u6b21\\u90ce\\u3055\\u3093\\u306b200\\u30c9\\u30eb\\u306e\\u9001\\u91d1\\u51e6\\u7406\\u304c\\u5b8c\\u4e86\\u3057\\u307e\\u3057\\u305f\\u3002\"}\n\n",
      "data: {\"type\": \"text-end\", \"id\": \"26609b40-7707-4602-b262-67374e5d97d3_output_text\"}\n\n",
      "data: {\"type\": \"finish\", \"finishReason\": \"stop\", \"messageMetadata\": {\"usage\": {\"promptTokens\": 1640, \"completionTokens\": null, \"totalTokens\": 1718}, \"audio\": {\"chunks\": 51, \"bytes\": 142080, \"sampleRate\": 24000, \"duration\": 2.96}, \"modelVersion\": \"gemini-2.5-flash-native-audio-preview-12-2025\"}}\n\n",
      "data: [DONE]\n\n"
    ],
    "expectedChunks": [
      {
        "type": "start",
        "messageId": "26609b40-7707-4602-b262-67374e5d97d3"
      },
      {
        "type": "reasoning-start",
        "id": "0"
      },
      {
        "type": "reasoning-delta",
        "id": "0",
        "delta": "**Defining the Tool Call**\n\nI'm now zeroing in on the correct `process_payment` tool call.  I've confirmed the recipient, Jiro-san, as a string and the amount, $200, in USD.  The tool parameters have been verified and I am ready to construct the call itself. It's almost ready for execution.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "0"
      },
      {
        "type": "reasoning-start",
        "id": "1"
      },
      {
        "type": "reasoning-delta",
        "id": "1",
        "delta": "**Refining the Payment Parameters**\n\nI've firmed up the recipient, Jiro-san, as a string and the payment amount as $200 in USD. The `process_payment` tool is definitely the correct one to use. I'm now crafting the tool call with those exact values and ensuring the arguments align with the tool definition. The structure is almost complete for submission, just confirming the details.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "1"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-10272706747688841769",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-10272706747688841769",
        "toolName": "process_payment",
        "input": {
          "amount": 200,
          "recipient": "次郎さん",
          "currency": "USD"
        }
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-10272706747688841769",
        "approvalId": "adk-3430557d-fed3-4843-8e3c-e113d3e6dc5f"
      },
      {
        "type": "tool-output-available",
        "toolCallId": "function-call-10272706747688841769",
        "output": {
          "success": true,
          "transaction_id": "txn_97acab733d43",
          "amount": 200,
          "currency": "USD",
          "recipient": "次郎さん",
          "description": "",
          "wallet_balance": 800.0,
          "timestamp": "2025-12-28T01:56:15.309941+00:00"
        }
      },
      {
        "type": "text-start",
        "id": "26609b40-7707-4602-b262-67374e5d97d3_output_text"
      },
      {
        "type": "text-delta",
        "id": "26609b40-7707-4602-b262-67374e5d97d3_output_text",
        "delta": "次郎さんに200ドルの送金処理が完了しました。"
      },
      {
        "type": "text-end",
        "id": "26609b40-7707-4602-b262-67374e5d97d3_output_text"
      },
      {
        "type": "finish",
        "finishReason": "stop",
        "messageMetadata": {
          "usage": {
            "promptTokens": 1640,
            "completionTokens": null,
            "totalTokens": 1718
          },
          "audio": {
            "chunks": 51,
            "bytes": 142080,
            "sampleRate": 24000,
            "duration": 2.96
          },
          "modelVersion": "gemini-2.5-flash-native-audio-preview-12-2025"
        }
      }
    ],
    "expectedDoneCount": 1,
    "expectedStreamCompletion": true
  }
}
