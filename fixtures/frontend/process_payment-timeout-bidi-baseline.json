{
  "description": "BIDI mode Phase 12 BLOCKING - process_payment with timeout flow (SINGLE CONTINUOUS STREAM, user doesn't respond)",
  "mode": "bidi",
  "source": "Backend E2E test capture",
  "scenario": "User receives approval request but doesn't respond - timeout after 30s",
  "note": "Phase 12 BLOCKING behavior: Single continuous stream with 1 [DONE]. Tool enters BLOCKING state awaiting approval, then times out after 30s and returns error.",
  "input": {
    "messages": [
      {
        "role": "user",
        "parts": [
          {
            "type": "text",
            "text": "Process a payment of $100 to Alice"
          }
        ]
      }
    ],
    "trigger": "submit-message"
  },
  "output": {
    "rawEvents": [
      "data: {\"type\": \"start\", \"messageId\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"0\", \"delta\": \"**Finding Payment Solutions**\\n\\nI've identified that the user wants a payment processed and found a suitable tool for that: `process_payment`.  It takes the amount, recipient, and currency as inputs.  I've mapped the user's intended values to the tool's required inputs. The default currency, USD, will be used. Thus, the parameters are set: `amount=100`, `recipient='Alice'`, and `currency='USD'`.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-13258368836728118994\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-13258368836728118994\", \"toolName\": \"process_payment\", \"input\": {\"recipient\": \"Alice\", \"currency\": \"USD\", \"amount\": 100}}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-13258368836728118994\", \"approvalId\": \"adk-7f45a4b1-0e46-40c5-a503-e5b20cf5b313\"}\n\n",
      "data: {\"type\": \"tool-output-error\", \"toolCallId\": \"function-call-13258368836728118994\", \"errorText\": \"Approval request timed out\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"1\", \"delta\": \"**Address Payment Failure**\\n\\nI've hit a snag. The payment process timed out during approval. Now, I need to craft a message to the user explaining that the transaction didn't go through due to the timeout. This communication will be crucial for managing their expectations and potentially prompting them to try again.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"text-start\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \"Payment approval\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \" timed\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \" out,\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \" so the\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \" payment\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \" was\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \" not\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\", \"delta\": \" processed.\"}\n\n",
      "data: {\"type\": \"text-end\", \"id\": \"8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text\"}\n\n",
      "data: {\"type\": \"finish\", \"finishReason\": \"stop\", \"messageMetadata\": {\"usage\": {\"promptTokens\": 1521, \"completionTokens\": null, \"totalTokens\": 1604}, \"audio\": {\"chunks\": 56, \"bytes\": 151680, \"sampleRate\": 24000, \"duration\": 3.16}, \"modelVersion\": \"gemini-2.5-flash-native-audio-preview-12-2025\"}}\n\n",
      "data: [DONE]\n\n"
    ],
    "expectedChunks": [
      {
        "type": "start",
        "messageId": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e"
      },
      {
        "type": "reasoning-start",
        "id": "0"
      },
      {
        "type": "reasoning-delta",
        "id": "0",
        "delta": "**Finding Payment Solutions**\n\nI've identified that the user wants a payment processed and found a suitable tool for that: `process_payment`.  It takes the amount, recipient, and currency as inputs.  I've mapped the user's intended values to the tool's required inputs. The default currency, USD, will be used. Thus, the parameters are set: `amount=100`, `recipient='Alice'`, and `currency='USD'`.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "0"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-13258368836728118994",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-13258368836728118994",
        "toolName": "process_payment",
        "input": {
          "recipient": "Alice",
          "currency": "USD",
          "amount": 100
        }
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-13258368836728118994",
        "approvalId": "adk-7f45a4b1-0e46-40c5-a503-e5b20cf5b313"
      },
      {
        "type": "tool-output-error",
        "toolCallId": "function-call-13258368836728118994",
        "errorText": "Approval request timed out"
      },
      {
        "type": "reasoning-start",
        "id": "1"
      },
      {
        "type": "reasoning-delta",
        "id": "1",
        "delta": "**Address Payment Failure**\n\nI've hit a snag. The payment process timed out during approval. Now, I need to craft a message to the user explaining that the transaction didn't go through due to the timeout. This communication will be crucial for managing their expectations and potentially prompting them to try again.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "1"
      },
      {
        "type": "text-start",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": "Payment approval"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": " timed"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": " out,"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": " so the"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": " payment"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": " was"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": " not"
      },
      {
        "type": "text-delta",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text",
        "delta": " processed."
      },
      {
        "type": "text-end",
        "id": "8d586fbc-37d7-4b0a-bee2-fe7174feb43e_output_text"
      },
      {
        "type": "finish",
        "finishReason": "stop",
        "messageMetadata": {
          "usage": {
            "promptTokens": 1521,
            "completionTokens": null,
            "totalTokens": 1604
          },
          "audio": {
            "chunks": 56,
            "bytes": 151680,
            "sampleRate": 24000,
            "duration": 3.16
          },
          "modelVersion": "gemini-2.5-flash-native-audio-preview-12-2025"
        }
      }
    ],
    "expectedDoneCount": 1,
    "expectedStreamCompletion": true
  }
}
