{
  "description": "BIDI SEQUENTIAL - deny×approve (Alice denied, Bob approved)",
  "mode": "bidi",
  "source": "Backend E2E test capture",
  "scenario": "BIDI sequential execution: Turn 1 (Alice request) → Turn 2 (Alice denied) → Turn 3 (Bob approved)",
  "note": "Tests BIDI sequential execution with mixed approval (deny×approve).",
  "input": {
    "messages": [
      {
        "role": "user",
        "content": "Aliceに30ドル、Bobに40ドル送金してください"
      }
    ],
    "trigger": "submit-message"
  },
  "output": {
    "rawEvents": [
      "data: {\"type\": \"start\", \"messageId\": \"acb82d94-a152-4b6d-a2c4-4990793aec56\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"0\", \"delta\": \"**Analyzing Payment Requests**\\n\\nI've determined the user needs two separate payments. I'll use the `process_payment` tool twice, once for Alice, and then for Bob. The first will process $30 for Alice and the second will process $40 for Bob, both in USD.  I'm ready to proceed with these tool calls.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-4633921991813159004\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-4633921991813159004\", \"toolName\": \"process_payment\", \"input\": {\"recipient\": \"Alice\", \"amount\": 30}}\n\n",
      "data: {\"type\":\"start-step\"}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-4633921991813159004\", \"approvalId\": \"adk-0242efda-2465-41d8-83f2-77f985cc579b\"}\n\n",
      "data: {\"type\":\"finish-step\"}\n\n",
      "data: {\"type\": \"tool-output-error\", \"toolCallId\": \"function-call-4633921991813159004\", \"errorText\": \"User denied the payment\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"1\", \"delta\": \"**Executing Second Payment**\\n\\nI've just been informed the first payment to Alice didn't go through. Now, I'm shifting gears to process the next one. Bob's payment of 40 USD is the priority, as per the updated instructions. I'm focusing on ensuring this transaction goes smoothly.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-9865876165296829971\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-9865876165296829971\", \"toolName\": \"process_payment\", \"input\": {\"amount\": 40, \"recipient\": \"Bob\"}}\n\n",
      "data: {\"type\":\"start-step\"}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-9865876165296829971\", \"approvalId\": \"adk-18d603ac-5ea1-4a57-bf04-8aa5b5ab2259\"}\n\n",
      "data: {\"type\":\"finish-step\"}\n\n",
      "data: {\"type\": \"tool-output-available\", \"toolCallId\": \"function-call-9865876165296829971\", \"output\": {\"success\": true, \"transaction_id\": \"txn_c7f1b19d4bb4\", \"amount\": 40, \"currency\": \"USD\", \"recipient\": \"Bob\", \"description\": \"\", \"wallet_balance\": 960.0, \"timestamp\": \"2025-12-31T14:32:01.718890+00:00\"}}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"2\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"2\", \"delta\": \"**Analyzing Transaction Outcomes**\\n\\nI've just finished analyzing the payment outcomes. The payment to Alice was unfortunately denied, but Bob's payment went through without a hitch. I need to make sure the user is informed about both results clearly and concisely.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"2\"}\n\n",
      "data: {\"type\": \"text-start\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"Alice\\u3078\\u306e\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u9001\\u91d1\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u306f\\u62d2\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u5426\\u3055\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u308c\\u307e\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u3057\\u305f\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u304c\\u3001\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"Bob\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u3078\\u306e40\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u30c9\\u30eb\\u306e\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u9001\\u91d1\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u306f\\u5b8c\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u4e86\\u3057\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\", \"delta\": \"\\u307e\\u3057\\u305f\\u3002\"}\n\n",
      "data: {\"type\": \"text-end\", \"id\": \"acb82d94-a152-4b6d-a2c4-4990793aec56_output_text\"}\n\n",
      "data: {\"type\": \"finish\", \"finishReason\": \"stop\", \"messageMetadata\": {\"usage\": {\"promptTokens\": 1750, \"completionTokens\": null, \"totalTokens\": 1887}, \"audio\": {\"chunks\": 107, \"bytes\": 249600, \"sampleRate\": 24000, \"duration\": 5.2}, \"modelVersion\": \"gemini-2.5-flash-native-audio-preview-12-2025\"}}\n\n",
      "data: [DONE]\n\n"
    ],
    "expectedChunks": [
      {
        "type": "start",
        "messageId": "acb82d94-a152-4b6d-a2c4-4990793aec56"
      },
      {
        "type": "reasoning-start",
        "id": "0"
      },
      {
        "type": "reasoning-delta",
        "id": "0",
        "delta": "**Analyzing Payment Requests**\n\nI've determined the user needs two separate payments. I'll use the `process_payment` tool twice, once for Alice, and then for Bob. The first will process $30 for Alice and the second will process $40 for Bob, both in USD.  I'm ready to proceed with these tool calls.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "0"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-4633921991813159004",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-4633921991813159004",
        "toolName": "process_payment",
        "input": {
          "recipient": "Alice",
          "amount": 30
        }
      },
      {
        "type": "start-step"
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-4633921991813159004",
        "approvalId": "adk-0242efda-2465-41d8-83f2-77f985cc579b"
      },
      {
        "type": "finish-step"
      },
      {
        "type": "tool-output-error",
        "toolCallId": "function-call-4633921991813159004",
        "errorText": "User denied the payment"
      },
      {
        "type": "reasoning-start",
        "id": "1"
      },
      {
        "type": "reasoning-delta",
        "id": "1",
        "delta": "**Executing Second Payment**\n\nI've just been informed the first payment to Alice didn't go through. Now, I'm shifting gears to process the next one. Bob's payment of 40 USD is the priority, as per the updated instructions. I'm focusing on ensuring this transaction goes smoothly.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "1"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-9865876165296829971",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-9865876165296829971",
        "toolName": "process_payment",
        "input": {
          "amount": 40,
          "recipient": "Bob"
        }
      },
      {
        "type": "start-step"
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-9865876165296829971",
        "approvalId": "adk-18d603ac-5ea1-4a57-bf04-8aa5b5ab2259"
      },
      {
        "type": "finish-step"
      },
      {
        "type": "tool-output-available",
        "toolCallId": "function-call-9865876165296829971",
        "output": {
          "success": true,
          "transaction_id": "txn_c7f1b19d4bb4",
          "amount": 40,
          "currency": "USD",
          "recipient": "Bob",
          "description": "",
          "wallet_balance": 960.0,
          "timestamp": "2025-12-31T14:32:01.718890+00:00"
        }
      },
      {
        "type": "reasoning-start",
        "id": "2"
      },
      {
        "type": "reasoning-delta",
        "id": "2",
        "delta": "**Analyzing Transaction Outcomes**\n\nI've just finished analyzing the payment outcomes. The payment to Alice was unfortunately denied, but Bob's payment went through without a hitch. I need to make sure the user is informed about both results clearly and concisely.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "2"
      },
      {
        "type": "text-start",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "Aliceへの"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "送金"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "は拒"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "否さ"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "れま"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "した"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "が、"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "Bob"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "への40"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "ドルの"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "送金"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "は完"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "了し"
      },
      {
        "type": "text-delta",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text",
        "delta": "ました。"
      },
      {
        "type": "text-end",
        "id": "acb82d94-a152-4b6d-a2c4-4990793aec56_output_text"
      },
      {
        "type": "finish",
        "finishReason": "stop",
        "messageMetadata": {
          "usage": {
            "promptTokens": 1750,
            "completionTokens": null,
            "totalTokens": 1887
          },
          "audio": {
            "chunks": 107,
            "bytes": 249600,
            "sampleRate": 24000,
            "duration": 5.2
          },
          "modelVersion": "gemini-2.5-flash-native-audio-preview-12-2025"
        }
      }
    ],
    "expectedDoneCount": 1,
    "expectedStreamCompletion": true
  }
}
