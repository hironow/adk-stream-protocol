{
  "description": "BIDI mode baseline - SEQUENTIAL process_payment with approval flows (3 TURNS: Alice → Bob → response)",
  "mode": "bidi",
  "source": "Backend E2E test capture",
  "scenario": "User requests two payments (Alice 30ドル, Bob 40ドル) in single message - BIDI executes SEQUENTIALLY: Turn 1 (Alice approval request) → Turn 2 (Alice execution + Bob approval request) → Turn 3 (Bob execution + final response)",
  "note": "This fixture demonstrates BIDI mode's sequential tool execution limitation (Gemini Live API behavior). Unlike SSE which generates both tool calls in parallel, BIDI generates tools one at a time due to types.Behavior.BLOCKING. This is a fundamental difference between SSE (generateContent API) and BIDI (Live API).",
  "input": {
    "messages": [
      {
        "role": "user",
        "content": "Aliceに30ドル、Bobに40ドル送金してください"
      }
    ],
    "trigger": "submit-message"
  },
  "output": {
    "rawEvents": [
      "data: {\"type\": \"start\", \"messageId\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"0\", \"delta\": \"**Planning Payment Execution**\\n\\nI've determined I need to make two separate calls to `process_payment`, one for Alice and another for Bob, each in USD. Amounts are $30 and $40, respectively. I'm focusing on the logic to execute these calls with the correct parameters, including the currency, even though it appears the tool doesn't explicitly handle user approval as described.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"1\", \"delta\": \"**Defining Tool Calls**\\n\\nI'm now generating the calls to the `process_payment` tool. I will send USD $30 to Alice and USD $40 to Bob. I'm accounting for the implicit USD currency from the user's input, even though they used \\\"\\u30c9\\u30eb\\\" in their example. The tool call requires the recipient, amount, and currency, with USD as the default if omitted.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-10979510385734015976\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-10979510385734015976\", \"toolName\": \"process_payment\", \"input\": {\"currency\": \"USD\", \"recipient\": \"Alice\", \"amount\": 30}}\n\n",
      "data: {\"type\":\"start-step\"}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-10979510385734015976\", \"approvalId\": \"confirm-f59e14e7-2fcf-4798-9fc9-bcc89b9df645\"}\n\n",
      "data: {\"type\":\"finish-step\"}\n\n",
      "data: {\"type\": \"tool-output-available\", \"toolCallId\": \"function-call-10979510385734015976\", \"output\": {\"success\": true, \"transaction_id\": \"txn_acf8ea3585c7\", \"amount\": 30, \"currency\": \"USD\", \"recipient\": \"Alice\", \"description\": \"\", \"wallet_balance\": 970.0, \"timestamp\": \"2026-01-17T14:42:52.065447+00:00\"}}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-15109892570096751916\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-15109892570096751916\", \"toolName\": \"process_payment\", \"input\": {\"currency\": \"USD\", \"recipient\": \"Bob\", \"amount\": 40}}\n\n",
      "data: {\"type\":\"start-step\"}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-15109892570096751916\", \"approvalId\": \"confirm-e5f05de4-5a16-44dd-ab4f-0deee4ce267c\"}\n\n",
      "data: {\"type\":\"finish-step\"}\n\n",
      "data: {\"type\": \"tool-output-available\", \"toolCallId\": \"function-call-15109892570096751916\", \"output\": {\"success\": true, \"transaction_id\": \"txn_2a64f1436c7b\", \"amount\": 40, \"currency\": \"USD\", \"recipient\": \"Bob\", \"description\": \"\", \"wallet_balance\": 960.0, \"timestamp\": \"2026-01-17T14:42:52.364197+00:00\"}}\n\n",
      "data: {\"type\": \"text-start\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\", \"delta\": \"Alice\\u306b30\\u30c9\\u30eb\\u3001\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\", \"delta\": \" Bob\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\", \"delta\": \"\\u306b40\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\", \"delta\": \"\\u30c9\\u30eb\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\", \"delta\": \"\\u9001\\u91d1\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\", \"delta\": \"\\u3057\\u307e\\u3057\\u305f\\u3002\"}\n\n",
      "data: {\"type\": \"text-end\", \"id\": \"912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text\"}\n\n",
      "data: {\"type\": \"finish\", \"finishReason\": \"stop\", \"messageMetadata\": {\"usage\": {\"promptTokens\": 1838, \"completionTokens\": null, \"totalTokens\": 1911}, \"audio\": {\"chunks\": 46, \"bytes\": 132480, \"sampleRate\": 24000, \"duration\": 2.76}, \"modelVersion\": \"gemini-2.5-flash-native-audio-preview-12-2025\"}}\n\n",
      "data: [DONE]\n\n"
    ],
    "expectedChunks": [
      {
        "type": "start",
        "messageId": "912f3bc7-d98d-4d65-93f0-ec360b307e62"
      },
      {
        "type": "reasoning-start",
        "id": "0"
      },
      {
        "type": "reasoning-delta",
        "id": "0",
        "delta": "**Planning Payment Execution**\n\nI've determined I need to make two separate calls to `process_payment`, one for Alice and another for Bob, each in USD. Amounts are $30 and $40, respectively. I'm focusing on the logic to execute these calls with the correct parameters, including the currency, even though it appears the tool doesn't explicitly handle user approval as described.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "0"
      },
      {
        "type": "reasoning-start",
        "id": "1"
      },
      {
        "type": "reasoning-delta",
        "id": "1",
        "delta": "**Defining Tool Calls**\n\nI'm now generating the calls to the `process_payment` tool. I will send USD $30 to Alice and USD $40 to Bob. I'm accounting for the implicit USD currency from the user's input, even though they used \"ドル\" in their example. The tool call requires the recipient, amount, and currency, with USD as the default if omitted.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "1"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-10979510385734015976",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-10979510385734015976",
        "toolName": "process_payment",
        "input": {
          "currency": "USD",
          "recipient": "Alice",
          "amount": 30
        }
      },
      {
        "type": "start-step"
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-10979510385734015976",
        "approvalId": "confirm-f59e14e7-2fcf-4798-9fc9-bcc89b9df645"
      },
      {
        "type": "finish-step"
      },
      {
        "type": "tool-output-available",
        "toolCallId": "function-call-10979510385734015976",
        "output": {
          "success": true,
          "transaction_id": "txn_acf8ea3585c7",
          "amount": 30,
          "currency": "USD",
          "recipient": "Alice",
          "description": "",
          "wallet_balance": 970.0,
          "timestamp": "2026-01-17T14:42:52.065447+00:00"
        }
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-15109892570096751916",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-15109892570096751916",
        "toolName": "process_payment",
        "input": {
          "currency": "USD",
          "recipient": "Bob",
          "amount": 40
        }
      },
      {
        "type": "start-step"
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-15109892570096751916",
        "approvalId": "confirm-e5f05de4-5a16-44dd-ab4f-0deee4ce267c"
      },
      {
        "type": "finish-step"
      },
      {
        "type": "tool-output-available",
        "toolCallId": "function-call-15109892570096751916",
        "output": {
          "success": true,
          "transaction_id": "txn_2a64f1436c7b",
          "amount": 40,
          "currency": "USD",
          "recipient": "Bob",
          "description": "",
          "wallet_balance": 960.0,
          "timestamp": "2026-01-17T14:42:52.364197+00:00"
        }
      },
      {
        "type": "text-start",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text"
      },
      {
        "type": "text-delta",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text",
        "delta": "Aliceに30ドル、"
      },
      {
        "type": "text-delta",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text",
        "delta": " Bob"
      },
      {
        "type": "text-delta",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text",
        "delta": "に40"
      },
      {
        "type": "text-delta",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text",
        "delta": "ドル"
      },
      {
        "type": "text-delta",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text",
        "delta": "送金"
      },
      {
        "type": "text-delta",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text",
        "delta": "しました。"
      },
      {
        "type": "text-end",
        "id": "912f3bc7-d98d-4d65-93f0-ec360b307e62_output_text"
      },
      {
        "type": "finish",
        "finishReason": "stop",
        "messageMetadata": {
          "usage": {
            "promptTokens": 1838,
            "completionTokens": null,
            "totalTokens": 1911
          },
          "audio": {
            "chunks": 46,
            "bytes": 132480,
            "sampleRate": 24000,
            "duration": 2.76
          },
          "modelVersion": "gemini-2.5-flash-native-audio-preview-12-2025"
        }
      }
    ],
    "expectedDoneCount": 1,
    "expectedStreamCompletion": true
  }
}
