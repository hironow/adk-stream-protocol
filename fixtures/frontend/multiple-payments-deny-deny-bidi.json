{
  "description": "BIDI SEQUENTIAL - deny×deny (Both denied)",
  "mode": "bidi",
  "source": "Backend E2E test capture",
  "scenario": "BIDI sequential execution: Turn 1 (Alice request) → Turn 2 (Alice denied) → Turn 3 (Bob denied)",
  "note": "Tests BIDI sequential execution with both denials (deny×deny).",
  "input": {
    "messages": [
      {
        "role": "user",
        "content": "Aliceに30ドル、Bobに40ドル送金してください"
      }
    ],
    "trigger": "submit-message"
  },
  "output": {
    "rawEvents": [
      "data: {\"type\": \"start\", \"messageId\": \"76ac6341-05bc-484a-904e-0ecd3d73008f\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"0\", \"delta\": \"**Generating Payment Actions**\\n\\nI've determined the need for two separate `process_payment` tool calls, one for Alice ($30) and another for Bob ($40), both in USD. I'm building these tool calls now, ready to be sent. The implicit user approval flows required by `process_payment` are also in place for both calls.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"0\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-4132076293338020419\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-4132076293338020419\", \"toolName\": \"process_payment\", \"input\": {\"amount\": 30, \"recipient\": \"Alice\", \"currency\": \"USD\"}}\n\n",
      "data: {\"type\":\"start-step\"}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-4132076293338020419\", \"approvalId\": \"confirm-c0e8459c-6b37-4dda-a4e0-00563ca71716\"}\n\n",
      "data: {\"type\":\"finish-step\"}\n\n",
      "data: {\"type\": \"tool-output-error\", \"toolCallId\": \"function-call-4132076293338020419\", \"errorText\": \"User denied the payment\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"1\", \"delta\": \"**Addressing the Second Payment**\\n\\nI'm focused on the second payment request. The initial transaction with Alice was rejected, but I'm proceeding with the one for Bob's 40 USD. It's crucial to keep them distinct, so I'm processing Bob's payment independently.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"1\"}\n\n",
      "data: {\"type\": \"tool-input-start\", \"toolCallId\": \"function-call-3696417290158933246\", \"toolName\": \"process_payment\"}\n\n",
      "data: {\"type\": \"tool-input-available\", \"toolCallId\": \"function-call-3696417290158933246\", \"toolName\": \"process_payment\", \"input\": {\"amount\": 40, \"recipient\": \"Bob\", \"currency\": \"USD\"}}\n\n",
      "data: {\"type\":\"start-step\"}\n\n",
      "data: {\"type\": \"tool-approval-request\", \"toolCallId\": \"function-call-3696417290158933246\", \"approvalId\": \"confirm-d663ce51-fbd6-4c1e-b246-75c6031ca1b7\"}\n\n",
      "data: {\"type\":\"finish-step\"}\n\n",
      "data: {\"type\": \"tool-output-error\", \"toolCallId\": \"function-call-3696417290158933246\", \"errorText\": \"User denied the payment\"}\n\n",
      "data: {\"type\": \"reasoning-start\", \"id\": \"2\"}\n\n",
      "data: {\"type\": \"reasoning-delta\", \"id\": \"2\", \"delta\": \"**Notifying Failed Transactions**\\n\\nI see that both payment requests, $30 to Alice and $40 to Bob, were denied. I must immediately inform the user that both transactions have failed.\\n\\n\\n\"}\n\n",
      "data: {\"type\": \"reasoning-end\", \"id\": \"2\"}\n\n",
      "data: {\"type\": \"text-start\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u7533\\u3057\\u8a33\\u3042\\u308a\\u307e\\u305b\\u3093\\u304c\\u3001\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u30e6\\u30fc\\u30b6\\u30fc\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u306e\\u62d2\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u5426\\u306b\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u3088\\u308a\\u3001\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \" Alice\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u3068Bob\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u3078\\u306e\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u9001\\u91d1\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u304c\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u6b63\\u5e38\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u306b\\u51e6\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u7406\\u3067\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u304d\\u307e\\u305b\"}\n\n",
      "data: {\"type\": \"text-delta\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\", \"delta\": \"\\u3093\\u3067\\u3057\\u305f\\u3002\"}\n\n",
      "data: {\"type\": \"text-end\", \"id\": \"76ac6341-05bc-484a-904e-0ecd3d73008f_output_text\"}\n\n",
      "data: {\"type\": \"finish\", \"finishReason\": \"stop\", \"messageMetadata\": {\"usage\": {\"promptTokens\": 1706, \"completionTokens\": null, \"totalTokens\": 1854}, \"audio\": {\"chunks\": 124, \"bytes\": 282240, \"sampleRate\": 24000, \"duration\": 5.88}, \"modelVersion\": \"gemini-2.5-flash-native-audio-preview-12-2025\"}}\n\n",
      "data: [DONE]\n\n"
    ],
    "expectedChunks": [
      {
        "type": "start",
        "messageId": "76ac6341-05bc-484a-904e-0ecd3d73008f"
      },
      {
        "type": "reasoning-start",
        "id": "0"
      },
      {
        "type": "reasoning-delta",
        "id": "0",
        "delta": "**Generating Payment Actions**\n\nI've determined the need for two separate `process_payment` tool calls, one for Alice ($30) and another for Bob ($40), both in USD. I'm building these tool calls now, ready to be sent. The implicit user approval flows required by `process_payment` are also in place for both calls.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "0"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-4132076293338020419",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-4132076293338020419",
        "toolName": "process_payment",
        "input": {
          "amount": 30,
          "recipient": "Alice",
          "currency": "USD"
        }
      },
      {
        "type": "start-step"
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-4132076293338020419",
        "approvalId": "confirm-c0e8459c-6b37-4dda-a4e0-00563ca71716"
      },
      {
        "type": "finish-step"
      },
      {
        "type": "tool-output-error",
        "toolCallId": "function-call-4132076293338020419",
        "errorText": "User denied the payment"
      },
      {
        "type": "reasoning-start",
        "id": "1"
      },
      {
        "type": "reasoning-delta",
        "id": "1",
        "delta": "**Addressing the Second Payment**\n\nI'm focused on the second payment request. The initial transaction with Alice was rejected, but I'm proceeding with the one for Bob's 40 USD. It's crucial to keep them distinct, so I'm processing Bob's payment independently.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "1"
      },
      {
        "type": "tool-input-start",
        "toolCallId": "function-call-3696417290158933246",
        "toolName": "process_payment"
      },
      {
        "type": "tool-input-available",
        "toolCallId": "function-call-3696417290158933246",
        "toolName": "process_payment",
        "input": {
          "amount": 40,
          "recipient": "Bob",
          "currency": "USD"
        }
      },
      {
        "type": "start-step"
      },
      {
        "type": "tool-approval-request",
        "toolCallId": "function-call-3696417290158933246",
        "approvalId": "confirm-d663ce51-fbd6-4c1e-b246-75c6031ca1b7"
      },
      {
        "type": "finish-step"
      },
      {
        "type": "tool-output-error",
        "toolCallId": "function-call-3696417290158933246",
        "errorText": "User denied the payment"
      },
      {
        "type": "reasoning-start",
        "id": "2"
      },
      {
        "type": "reasoning-delta",
        "id": "2",
        "delta": "**Notifying Failed Transactions**\n\nI see that both payment requests, $30 to Alice and $40 to Bob, were denied. I must immediately inform the user that both transactions have failed.\n\n\n"
      },
      {
        "type": "reasoning-end",
        "id": "2"
      },
      {
        "type": "text-start",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "申し訳ありませんが、"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "ユーザー"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "の拒"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "否に"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "より、"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": " Alice"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "とBob"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "への"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "送金"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "が"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "正常"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "に処"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "理で"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "きませ"
      },
      {
        "type": "text-delta",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text",
        "delta": "んでした。"
      },
      {
        "type": "text-end",
        "id": "76ac6341-05bc-484a-904e-0ecd3d73008f_output_text"
      },
      {
        "type": "finish",
        "finishReason": "stop",
        "messageMetadata": {
          "usage": {
            "promptTokens": 1706,
            "completionTokens": null,
            "totalTokens": 1854
          },
          "audio": {
            "chunks": 124,
            "bytes": 282240,
            "sampleRate": 24000,
            "duration": 5.88
          },
          "modelVersion": "gemini-2.5-flash-native-audio-preview-12-2025"
        }
      }
    ],
    "expectedDoneCount": 1,
    "expectedStreamCompletion": true
  }
}
